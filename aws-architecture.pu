@startuml
!define AWSPuml https://raw.githubusercontent.com/awslabs/aws-icons-for-plantuml/v14.0/dist
!include AWSPuml/AWSCommon.puml
!include AWSPuml/General/Users.puml
!include AWSPuml/Groups/AWSCloud.puml
!include AWSPuml/Groups/Generic.puml
!include AWSPuml/NetworkingContentDelivery/CloudFront.puml
!include AWSPuml/Storage/SimpleStorageService.puml
!include AWSPuml/Compute/LambdaLambdaFunction.puml
!include AWSPuml/FrontEndWebMobile/Amplify.puml

title Wedding Photo Upload App - AWS Architecture

skinparam shadowing false
hide stereotype
skinparam linetype ortho

!procedure $stepnum($number) 
<back:royalblue><color:white><b> $number </b></color></back>
!endprocedure

rectangle "$UsersIMG()\nUsers\n(Mobile/Desktop)" as users

' External Neon Database (outside AWS Cloud)
rectangle "ðŸ˜ Neon PostgreSQL\nExternal Cloud DB\nServerless Postgres" as neon #00E5FF

AWSCloudGroup(aws) {
    ' Frontend Layer
    rectangle "$CloudFrontIMG()\nAmazon CloudFront\nGlobal Content Delivery\nCaching & HTTPS" as cloudfront

    rectangle "$AmplifyIMG()\nAWS Amplify\nNext.js 15 App Router\nâ€¢ /api/upload\nâ€¢ /api/photos\nâ€¢ /api/debug-env\nâ€¢ /api/migrate" as amplify

    ' Storage Layer
    rectangle "$SimpleStorageServiceIMG()\nAmazon S3\nshota-wedding-photos-bucket\nPhoto Storage" as s3
    ' Security Layer
    rectangle "$IdentityAccessManagementIMG()\nAWS IAM\nS3 Access Permissions\nLambda Execution" as iam
}

' Layout positioning
users -[hidden]down-> cloudfront
cloudfront -[hidden]down-> amplify
amplify -[hidden]down-> s3
neon -[hidden]right-> aws

' Main Data Flow
users --> cloudfront : $stepnum("1") Access Web App
cloudfront --> amplify : $stepnum("2") Serve App

' Photo Upload Flow
users --> amplify : $stepnum("3") Request Upload URL\n(/api/upload)
amplify --> s3 : Generate Presigned URL
users --> s3 : $stepnum("4") Direct Upload

' Metadata Flow
users --> amplify : $stepnum("5") Save Metadata\n(/api/photos)
amplify --> neon : Store via Prisma

' Gallery View Flow
users --> amplify : $stepnum("6") Get Photos\n(/api/photos)
amplify <-- neon : Photo List via Prisma
users <-- cloudfront : $stepnum("7") View Gallery
cloudfront <-- s3 : Cached Images

' Security & Permission Flow
iam -.-> amplify : S3 Access Credentials
iam -.-> s3 : Access Permissions

' Key Components Overview
note top of cloudfront
<b>Wedding Photo Upload App</b>
ãƒ»Next.js 15 App Router + Tailwind CSS
ãƒ»API Routes in Amplify
ãƒ»Instagram-style gallery
ãƒ»Mobile-first design
end note

note right of neon
<b>Database Schema (Prisma)</b>
photos table:
ãƒ»id, nickname, comment
ãƒ»s3Key, cloudFrontUrl
ãƒ»uploadedAt
end note

note bottom of s3
<b>Storage</b>
ãƒ»Private S3 bucket
ãƒ»Presigned URL upload
ãƒ»CloudFront CDN
ãƒ»/photos/{timestamp}-{filename}
end note

@enduml